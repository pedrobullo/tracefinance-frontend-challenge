# AI Rules - Trace Finance

Este documento define as regras e boas práticas para IAs que trabalham neste codebase.

## Estrutura do Projeto

```
trace/
├── apps/
│   ├── web/              # App Next.js principal
│   │   ├── app/          # App Router (páginas)
│   │   ├── components/   # Componentes one-time (específicos do app)
│   │   ├── contexts/     # React Contexts (providers)
│   │   ├── hooks/        # Custom hooks
│   │   ├── lib/          # Utilitários e configurações
│   │   ├── services/     # Camada de API
│   │   ├── types/        # TypeScript types
│   │   └── __tests__/    # Testes
│   └── storybook/        # Documentação de componentes
└── packages/
    └── ui/               # Componentes reutilizáveis
        └── src/
            ├── tokens/   # Design tokens
            └── constants/ # Constantes globais
```

## Padrões de Código

### KISS (Keep It Simple, Stupid)

- Evite over-engineering
- Prefira soluções simples e diretas
- Menos código = menos bugs

### DRY (Don't Repeat Yourself)

- Use constantes em `@repo/ui/constants`
- Crie custom hooks para lógica reutilizável
- Componentes compartilhados vão no pacote `@repo/ui`

### Single Responsibility

- Cada componente deve ter uma única responsabilidade
- Componentes com mais de 200-300 linhas devem ser divididos
- Extraia lógica complexa para hooks

### Type Safety

- **NUNCA** use `any`
- Defina types explícitos para props
- Use `as const` para constantes

## Convenções

### Comentários

- **Convencionais**: Inglês (ex: `// Transaction types`, `// Pagination settings`)
- **Para revisor**: Português informal, como se estivesse conversando (ex: `// Aqui a gente precisa validar antes porque...`)
- Explique o "porquê", não o "o quê"

### Arquivos

- Componentes: PascalCase (`Button.tsx`)
- Hooks: camelCase com prefixo `use` (`useTransactions.ts`)
- Tipos: camelCase (`transaction.ts`)
- Constantes: UPPER_SNAKE_CASE

**Nota Windows**: Para renomear arquivos alterando apenas o case, use `git mv`:

```bash
git mv button.tsx temp.tsx && git mv temp.tsx Button.tsx
```

### Imports

- Path aliases: `@/components`, `@/hooks`, etc.
- Package UI: `@repo/ui`

## Stack Técnica

- **Framework**: Next.js 16+ (App Router)
- **Linguagem**: TypeScript (strict)
- **Estilização**: Tailwind CSS
- **Estado**: React Query + Context API
- **Formulários**: React Hook Form + Zod
- **Ícones**: Heroicons
- **Testes**: Jest + Testing Library

## API

### Wrapper `apiCall`

Todas as chamadas à API devem usar o wrapper em `services/api.ts`:

- Tratamento centralizado de erros
- Headers padrão
- Toast de erro automático

### React Query

- Use hooks customizados em `hooks/`
- Keys centralizadas (`transactionKeys`)
- Infinite query para listas paginadas

## Componentes UI

### Quando criar no `@repo/ui`

- Componente usado em múltiplos lugares
- Componente genérico (Button, Input, Modal)
- Componente que faz parte do design system

### Quando criar em `web/components`

- Componente específico do app
- Componente one-time
- Composição de componentes UI

## Testes

### Estrutura

```
__tests__/
├── components/   # Testes de componentes
├── hooks/        # Testes de hooks
└── services/     # Testes de serviços
```

### Convenções

- Arquivos: `*.test.tsx` ou `*.test.ts`
- Descrições em português
- Mock de dependências externas

## Feature Flags

Atualmente via `process.env`:

```typescript
const isEnabled = process.env.NEXT_PUBLIC_FEATURE_NAME === "true";
```

Para produção, considerar: LaunchDarkly, Flagsmith, Unleash.

## Internacionalização (i18n)

- Arquivos de tradução em `lib/i18n/translations/`
- Hook `useTranslation()` para acessar `t`
- Suporta `pt-BR` e `en-US`

## Decisões para Migração

### Componentes para migrar ao `@repo/ui`

Avaliar caso a caso. Se um componente de `web/components` for reutilizado:

1. Mover para `packages/ui/src/`
2. Exportar no `index.ts`
3. Atualizar imports

### Quando NÃO migrar

- Componentes com lógica de negócio
- Componentes que dependem de contextos do app
- Componentes muito específicos
